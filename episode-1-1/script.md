<h1>词法分析</h1>

> Version 1.0.0 by GodGnidoc; Jul. 13, 2024

# 1. 概览

形式语言词法分析的任务是依据词法规则将源码从字符序列分割成单词序列。

这一步骤为语法分析排除了单词 内部结构细节 带来的干扰。令语法分析器的复杂度大大降低，得以编码实现。

本章内容，我们将一起学习词法分析工作中的重要概念，并自己动手，逐步编写词法分析器。

通常，我们认为，能够用 正则文法 描述的规则即为词法规则，满足正则文法的句子的集合也可以被称为正则语言。而正则文法的正规书写形式则被称为正则表达式。

本章的第一部分，我们将介绍一些正则表达式的语法规则，并编写一个可以读取并结构化存储正则表达式的组件以备后续使用。

正则语言需要有穷状态机来处理。有穷状态机由状态跳转图驱动，它会在逐个读取输入字符的过程中跳转状态，直到某个输入令它接受已读取的单词或报告一个词法错误。每次分析完一个单词，回到初始状态继续读取字符就可以开始分析下一个单词了。

本章的第二部分，我们来设计一个有穷状态机和用于驱动它的状态跳转图的结构。

状态跳转图与词法规则一一对应，替换不同的状态跳转图即可令有穷状态机执行不同的词法规则。

本章的第三部分，我们来学习一种可以从正则表达式直接构造状态跳转图的算法。然后编码将各个组件集成起来，完成词法分析器的开发。

以上是本章内容的概览，我们跳过了一些按照龙书章节顺序可能会学到的算法或概念，如果有小伙伴希望更深入地掌握这部分内容，可以阅读机械工业出版社出版的编译原理第二版第三章的内容。

# 2. 正则表达式语法

接下来我们来学习本章的第一节的内容，正则表达式的语法。

对于经常处理文本输入的小伙伴来说，正则表达式可能并不陌生。我们经常编写正则表达式来检查一段文本是否满足格式要求，或者利用正则表达式来查找字符串中满足特定模式的子串。

一条正则表达式的 含义 通常被称为 模式，满足该模式的字符串应当具备相同的结构特征。通过嵌套应用不同的正则表达式语法，我们即可描述复杂的字符串结构特征。

接下来，我们将逐一详细讲解开发词法分析器需要了解的正则表达式语法。

请注意，标准正则表达式的功能非常丰富，我们接下来只会学习到其中编写词法分析器时必须要掌握的一小部分，且部分细节有所定制。如果有小伙伴希望在其它场景应用正则表达式，可以参考这些正式材料。

首先，最简单的正则表达式就是基本字符，一个基本字符就是一个完整的正则表达式了。基本字符遵循C语言常用的转义规则，回车换行及单双引号等特殊字符都是需要前缀一个反斜杠表示转义的。它所匹配的就是构成表达式的确切字符，其它任何字符都不接受。

若我们希望在众多字符中任选一个，则可以使用字符类语法。它由一对方括号将候选字符包裹起来。在方括号中除了可以逐一列举候选字符以外，还可以用连字符将一段候选范围的起止字符连接起来表示这个范围内的字符我们都接受。

与之相反，如果我们想表示 只排除所提及的字符而接受其它任意字符 的话。可以在方括号内部最开始的地方添加一个插入符号。

从上述语法规则不难看出，在方括号内，如果想表示一个插入符号、减号或右方括号的话，也是需要转义的。

除了方括号领起的字符类以外，我们还可以借助转义规则来表示一些预定义的字符类，这将极大简化复杂词法的正则表达式的编写，我们支持的转义字符类越多，表达式写起来就会越方便。下表是我们计划支持的全部转义字符类以及它们所表示的选择范围。

到目前为止，我们所匹配的字符串都只有一个字符，如何匹配更长的字符串呢？

答案很直观，只要将我们想要匹配的各个正则表达式连在一起写，就构成了串语法。串语法要求文本按次序匹配串中每个正则表达式所描述的模式。

如果我们想表示某一个模式是可选的，可以出现也可以不出现要怎么办呢？我们可以在这个模式对应的正则表达式后面后缀一个问号，它表示这个模式可能出现零次或一次。

要注意，正则表达式中所有后缀运算符的优先级高于串运算符，这意味着它只能修饰串中紧挨着问号左侧的第一个模式。如果我们想表示的不仅仅是一个字符的可选，而是一个子串的可选该怎么办呢？

可以用小括号把一段表达式扩起来，表示打包形成一个子式。这样子式中的内容就可以一起被后缀运算符修饰了。

另外两种后缀运算符分别是克林闭包和正闭包。

在表达式后缀一个星号可以形成克林闭包，表示所修饰的模式可以连续出现零次或多次。

在表达式后缀一个加号可以形成正闭包，表示所修饰的模式可以连续出现一次或多次。

最后一种语法被成为联合语法，它将两个正则表达式联合在一起形成两种可选项。表示左子式或右子式完全匹配其中之一即可。

联合运算的优先级低于串运算，所以要想在串中穿插一个由两个子表达式形成的联合子式，需要添加括号形成隔离。否则暴露在外的联合运算符会把整条表达式都切成两半。

# 3. 小节完

至此，我们已经快速浏览了后续章节所需的全部正则表达式语法。下一小节，我们将开始动手编写一个正则表达式的编译器用于解析并结构化存储正则表达式。

祝大家生活愉快，我们下期视频再见。